<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è –º–∞—Ä–∫–µ—Ä–æ–≤</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: white;
        }
        
        .controls {
            position: fixed;
            top: 10px;
            left: 10px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px;
            border-radius: 5px;
        }
        
        .status {
            position: fixed;
            bottom: 10px;
            left: 10px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
        }
        
        #viewer-container {
            width: 100vw;
            height: 100vh;
        }
    </style>
</head>
<body>
    <div class="controls">
        <h3>üéØ –¢–µ—Å—Ç –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è –º–∞—Ä–∫–µ—Ä–æ–≤</h3>
        <button id="add-marker">‚ûï –î–æ–±–∞–≤–∏—Ç—å –º–∞—Ä–∫–µ—Ä</button>
        <button id="reset-scene">üîÑ –°–±—Ä–æ—Å —Å—Ü–µ–Ω—ã</button>
    </div>
    
    <div class="status" id="status">
        üìä –°—Ç–∞—Ç—É—Å: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...
    </div>
    
    <div id="viewer-container"></div>
    
    <script>
        // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ A-Frame, –∑–∞—Ç–µ–º —Ç–µ—Å—Ç–∏—Ä—É–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä
        document.addEventListener('DOMContentLoaded', () => {
            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ A-Frame
            setTimeout(() => {
                testCoordinateManager();
            }, 1000);
        });
        
        function testCoordinateManager() {
            import('./core/coordinate_manager.js').then((module) => {
                const CoordinateManager = module.default;
                const statusEl = document.getElementById('status');
            
            function updateStatus(text) {
                statusEl.innerHTML = text;
                console.log(text);
            }
            
            updateStatus('üìê CoordinateManager –∑–∞–≥—Ä—É–∂–µ–Ω');
            
            // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç—É—é A-Frame —Å—Ü–µ–Ω—É –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            const scene = document.createElement('a-scene');
            scene.setAttribute('embedded', true);
            scene.setAttribute('vr-mode-ui', 'enabled: false');
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–∞–º–µ—Ä—É
            const camera = document.createElement('a-camera');
            camera.setAttribute('look-controls', 'enabled: true');
            camera.setAttribute('wasd-controls', 'enabled: false');
            camera.setAttribute('position', '0 0 0');
            scene.appendChild(camera);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–±–æ (–ø—Ä–æ—Å—Ç–æ–π —Ü–≤–µ—Ç)
            const sky = document.createElement('a-sky');
            sky.setAttribute('color', '#232323');
            scene.appendChild(sky);
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ü–µ–Ω—É –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
            const container = document.getElementById('viewer-container');
            container.appendChild(scene);
            
            updateStatus('üé≠ A-Frame —Å—Ü–µ–Ω–∞ —Å–æ–∑–¥–∞–Ω–∞');
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä
            const coordinateManager = new CoordinateManager();
            
            setTimeout(() => {
                coordinateManager.initialize(scene);
                updateStatus('‚úÖ CoordinateManager –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                
                // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π –º–∞—Ä–∫–µ—Ä
                createTestMarker();
            }, 1000);
            
            function createTestMarker() {
                const marker = document.createElement('a-sphere');
                marker.setAttribute('radius', '0.3');
                marker.setAttribute('color', '#ff0000');
                marker.setAttribute('position', '0 0 -5');
                marker.id = 'test-marker';
                
                // –î–µ–ª–∞–µ–º –º–∞—Ä–∫–µ—Ä –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ–º—ã–º
                coordinateManager.createDraggableMarker(marker, (newPosition) => {
                    updateStatus(`üéØ –ú–∞—Ä–∫–µ—Ä –ø–µ—Ä–µ–º–µ—â–µ–Ω –≤: x=${newPosition.x.toFixed(2)}, y=${newPosition.y.toFixed(2)}, z=${newPosition.z.toFixed(2)}`);
                });
                
                scene.appendChild(marker);
                updateStatus('üìç –¢–µ—Å—Ç–æ–≤—ã–π –º–∞—Ä–∫–µ—Ä —Å–æ–∑–¥–∞–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è');
            }
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
            document.getElementById('add-marker').addEventListener('click', () => {
                const randomPos = {
                    x: (Math.random() - 0.5) * 10,
                    y: (Math.random() - 0.5) * 10,
                    z: -3 - Math.random() * 5
                };
                
                const marker = document.createElement('a-box');
                marker.setAttribute('width', '0.5');
                marker.setAttribute('height', '0.5');
                marker.setAttribute('depth', '0.5');
                marker.setAttribute('color', `#${Math.floor(Math.random()*16777215).toString(16)}`);
                marker.setAttribute('position', `${randomPos.x} ${randomPos.y} ${randomPos.z}`);
                marker.id = `marker-${Date.now()}`;
                
                coordinateManager.createDraggableMarker(marker, (newPosition) => {
                    updateStatus(`üé≤ –°–ª—É—á–∞–π–Ω—ã–π –º–∞—Ä–∫–µ—Ä –ø–µ—Ä–µ–º–µ—â–µ–Ω: x=${newPosition.x.toFixed(2)}, y=${newPosition.y.toFixed(2)}, z=${newPosition.z.toFixed(2)}`);
                });
                
                scene.appendChild(marker);
                updateStatus('üé≤ –î–æ–±–∞–≤–ª–µ–Ω —Å–ª—É—á–∞–π–Ω—ã–π –º–∞—Ä–∫–µ—Ä');
            });
            
            document.getElementById('reset-scene').addEventListener('click', () => {
                // –£–¥–∞–ª—è–µ–º –≤—Å–µ –º–∞—Ä–∫–µ—Ä—ã
                const markers = scene.querySelectorAll('a-sphere, a-box');
                markers.forEach(marker => marker.remove());
                updateStatus('üîÑ –í—Å–µ –º–∞—Ä–∫–µ—Ä—ã —É–¥–∞–ª–µ–Ω—ã');
                
                // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π –º–∞—Ä–∫–µ—Ä
                setTimeout(createTestMarker, 500);
            });
            
            }).catch(error => {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ CoordinateManager:', error);
                document.getElementById('status').innerHTML = '‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ CoordinateManager: ' + error.message;
            });
        }
    </script>
</body>
</html>
