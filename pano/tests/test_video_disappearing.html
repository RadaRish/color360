<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–¢–µ—Å—Ç –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è –≤–∏–¥–µ–æ-–æ–±–ª–∞—Å—Ç–µ–π</title>
    <style>
      body {
        font-family: system-ui, sans-serif;
        background: #1a1a1a;
        color: white;
        padding: 20px;
      }
      .test-section {
        background: #333;
        padding: 20px;
        border-radius: 8px;
        margin: 20px 0;
      }
      .controls {
        display: flex;
        gap: 10px;
        margin: 20px 0;
        flex-wrap: wrap;
      }
      button {
        padding: 10px 20px;
        background: #0066cc;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
      }
      button:hover {
        background: #0055aa;
      }
      button.danger {
        background: #cc3300;
      }
      button.success {
        background: #00cc66;
      }
      .log {
        background: #222;
        padding: 10px;
        border-radius: 4px;
        margin: 10px 0;
        font-family: monospace;
        max-height: 400px;
        overflow-y: auto;
        font-size: 12px;
      }
      .viewer-container {
        width: 100%;
        height: 400px;
        border: 2px solid #555;
        border-radius: 8px;
        margin: 20px 0;
        background: #222;
        position: relative;
      }
      iframe {
        width: 100%;
        height: 100%;
        border: none;
        border-radius: 6px;
      }
      .instruction {
        background: #222;
        padding: 15px;
        border-radius: 8px;
        margin: 10px 0;
        border-left: 4px solid #0066cc;
      }
    </style>
  </head>
  <body>
    <h1>üîß –¢–µ—Å—Ç –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è –≤–∏–¥–µ–æ-–æ–±–ª–∞—Å—Ç–µ–π</h1>

    <div class="test-section">
      <h2>üìã –ü–æ—à–∞–≥–æ–≤—ã–π —Ç–µ—Å—Ç</h2>
      <div class="instruction">
        <strong>–¢–µ—Å—Ç–∏—Ä—É–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ look-at –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞:</strong><br />
        1. –°–æ–∑–¥–∞–π—Ç–µ –≤–∏–¥–µ–æ-–æ–±–ª–∞—Å—Ç—å (–ü–ö–ú ‚Üí "–°–æ–∑–¥–∞—Ç—å –≤–∏–¥–µ–æ-–æ–±–ª–∞—Å—Ç—å")<br />
        2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—ë –ø–µ—Ä–µ—Ç–∞—â–∏—Ç—å<br />
        3. –ö–ª–∏–∫–Ω–∏—Ç–µ –ø–æ –ø—É—Å—Ç–æ–º—É –º–µ—Å—Ç—É —Å—Ü–µ–Ω—ã<br />
        4. <strong>–í–∏–¥–µ–æ-–æ–±–ª–∞—Å—Ç—å –ù–ï –¥–æ–ª–∂–Ω–∞ –∏—Å—á–µ–∑–Ω—É—Ç—å!</strong>
      </div>

      <div class="controls">
        <button onclick="openMainApp()" class="success">
          üöÄ –û—Ç–∫—Ä—ã—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        </button>
        <button onclick="startVideoAreaTest()" class="danger">
          üìπ –ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç –≤–∏–¥–µ–æ-–æ–±–ª–∞—Å—Ç–µ–π
        </button>
        <button onclick="clearLog()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
        <button onclick="watchConsole()">üëÅÔ∏è –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å</button>
      </div>
    </div>

    <div class="test-section">
      <h2>üñºÔ∏è –í—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
      <div class="viewer-container">
        <iframe id="app-frame" src="index.html"></iframe>
      </div>
    </div>

    <div class="test-section">
      <h2>üìä –ñ—É—Ä–Ω–∞–ª –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</h2>
      <div id="log" class="log"></div>
    </div>

    <script>
      let monitoring = false;
      let testStep = 0;
      let testStartTime = null;

      function log(message, type = "info") {
        const logElement = document.getElementById("log");
        const time = new Date().toLocaleTimeString();
        const colors = {
          info: "#ffffff",
          success: "#00ff00",
          warning: "#ffaa00",
          error: "#ff4444",
          step: "#00ccff",
        };
        const color = colors[type] || colors.info;
        logElement.innerHTML += `<span style="color: ${color}">[${time}] ${message}</span><br>`;
        logElement.scrollTop = logElement.scrollHeight;
      }

      function clearLog() {
        document.getElementById("log").innerHTML = "";
        log("üìã –õ–æ–≥ –æ—á–∏—â–µ–Ω");
      }

      function openMainApp() {
        window.open("index.html", "_blank");
        log("üöÄ –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–æ –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ", "success");
      }

      function startVideoAreaTest() {
        testStep = 0;
        testStartTime = Date.now();
        log("üß™ === –ù–ê–ß–ê–õ–û –¢–ï–°–¢–ê –í–ò–î–ï–û-–û–ë–õ–ê–°–¢–ï–ô ===", "step");
        log("‚úÖ Look-at –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –æ—Ç–∫–ª—é—á–µ–Ω—ã", "success");
        log("üìã –ü–æ—à–∞–≥–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:", "step");
        log(
          '  –®–∞–≥ 1: –°–æ–∑–¥–∞–π—Ç–µ –≤–∏–¥–µ–æ-–æ–±–ª–∞—Å—Ç—å (–ü–ö–ú –Ω–∞ —Å—Ü–µ–Ω–µ ‚Üí "–°–æ–∑–¥–∞—Ç—å –≤–∏–¥–µ–æ-–æ–±–ª–∞—Å—Ç—å")',
          "info"
        );
        log("  –®–∞–≥ 2: –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç—å –≤–∏–¥–µ–æ-–æ–±–ª–∞—Å—Ç—å", "info");
        log("  –®–∞–≥ 3: –ö–ª–∏–∫–Ω–∏—Ç–µ –ø–æ –ø—É—Å—Ç–æ–º—É –º–µ—Å—Ç—É —Å—Ü–µ–Ω—ã", "info");
        log("  –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤–∏–¥–µ–æ-–æ–±–ª–∞—Å—Ç—å –ù–ï –∏—Å—á–µ–∑–ª–∞!", "info");

        // –í–∫–ª—é—á–∞–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–æ–Ω—Å–æ–ª–∏
        watchConsole();
      }

      function watchConsole() {
        if (monitoring) {
          monitoring = false;
          log("üëÅÔ∏è –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–æ–Ω—Å–æ–ª–∏ –û–°–¢–ê–ù–û–í–õ–ï–ù", "warning");
          return;
        }

        monitoring = true;
        log("üëÅÔ∏è –ù–∞—á–∏–Ω–∞–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞...", "warning");
        log(
          "üîç –ò—â–µ–º: clearMarkers, look-at –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã, —É–¥–∞–ª–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–æ–≤",
          "info"
        );

        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º console.log
        const originalLog = console.log;
        const originalWarn = console.warn;
        const originalError = console.error;
        const originalTrace = console.trace;

        console.log = function (...args) {
          if (monitoring) {
            const message = args.join(" ");
            if (
              message.includes("clearMarkers") ||
              message.includes("üóëÔ∏è") ||
              message.includes("—É–¥–∞–ª—è–µ–º –º–∞—Ä–∫–µ—Ä") ||
              message.includes("look-at") ||
              message.includes("billboard")
            ) {
              log(`üîç –ö–û–ù–°–û–õ–¨: ${message}`, "warning");
            }
          }
          originalLog.apply(console, args);
        };

        console.warn = function (...args) {
          if (monitoring) {
            const message = args.join(" ");
            log(`‚ö†Ô∏è WARNING: ${message}`, "warning");
          }
          originalWarn.apply(console, args);
        };

        console.error = function (...args) {
          if (monitoring) {
            const message = args.join(" ");
            log(`‚ùå ERROR: ${message}`, "error");
          }
          originalError.apply(console, args);
        };

        console.trace = function (...args) {
          if (monitoring) {
            const message = args.join(" ");
            if (message.includes("clearMarkers")) {
              log(`üìç TRACE clearMarkers: ${message}`, "error");
            }
          }
          originalTrace.apply(console, args);
        };
      }

      // –°–ª—É—à–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç —Ñ—Ä–µ–π–º–∞
      window.addEventListener("message", (event) => {
        if (event.data && event.data.type && monitoring) {
          log(`üì® –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç —Ñ—Ä–µ–π–º–∞: ${JSON.stringify(event.data)}`, "info");
        }
      });

      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
      document.addEventListener("DOMContentLoaded", function () {
        log("üöÄ –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞");
        log(
          "üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –û—Ç–∫–ª—é—á–µ–Ω—ã look-at –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è –≤–∏–¥–µ–æ-–æ–±–ª–∞—Å—Ç–µ–π",
          "success"
        );
        log("üìù –ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è –≤–∏–¥–µ–æ-–æ–±–ª–∞—Å—Ç–µ–π!", "step");
      });

      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
      setTimeout(() => {
        log("‚è∞ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã...", "warning");
        setTimeout(startVideoAreaTest, 2000);
      }, 3000);
    </script>
  </body>
</html>
