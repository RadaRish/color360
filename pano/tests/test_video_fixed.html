<!DOCTYPE html>
<html>
<head>
  <title>–¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ –∫–æ–Ω—Ç—Ä–æ–ª–æ–≤</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #222;
      color: white;
    }
    .test-section {
      background: #333;
      padding: 20px;
      margin: 10px 0;
      border-radius: 10px;
    }
    .status {
      padding: 10px;
      margin: 5px 0;
      border-radius: 5px;
    }
    .success { background: #2d5016; color: #90ee90; }
    .error { background: #5d1a1a; color: #ffcdd2; }
    .warning { background: #4a3c1d; color: #fff3cd; }
    .info { background: #1a3a5d; color: #cde7ff; }
    button {
      padding: 10px 20px;
      margin: 5px;
      border: none;
      border-radius: 5px;
      background: #4CAF50;
      color: white;
      cursor: pointer;
    }
    button:hover { background: #45a049; }
    #testResults {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>üé¨ –¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ –∫–æ–Ω—Ç—Ä–æ–ª–æ–≤</h1>
  
  <div class="test-section">
    <h2>üìã –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏</h2>
    <button onclick="runAllTests()">üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã</button>
    <button onclick="clearStorage()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å localStorage</button>
    <button onclick="openMainApp()">üåê –û—Ç–∫—Ä—ã—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</button>
    
    <div id="testResults"></div>
  </div>

  <div class="test-section">
    <h2>‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h2>
    <div class="success">
      <h3>üõ†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã:</h3>
      <ul>
        <li><strong>localStorage –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:</strong> –ò—Å–∫–ª—é—á–∏–ª–∏ videoUrl –∏–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (—Ä–∞–∑–º–µ—Ä —Å–æ–∫—Ä–∞—Ç–∏–ª—Å—è —Å 1.6MB –¥–æ 0.7KB)</li>
        <li><strong>–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –≤–∏–¥–µ–æ:</strong> –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø–æ–∫–∞–∑–∞/—Å–∫—Ä—ã—Ç–∏—è –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –º—ã—à–∏</li>
        <li><strong>–ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ:</strong> –ü–æ–ª–Ω–æ—Å—Ç—å—é —É–±—Ä–∞–Ω–æ - –≤–∏–¥–µ–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ –∫–ª–∏–∫—É</li>
        <li><strong>–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:</strong> –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π –≤–∏–¥–µ–æ</li>
        <li><strong>–ú–∞—Ç–µ—Ä–∏–∞–ª—ã A-Frame:</strong> –£–ª—É—á—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤–∏–¥–µ–æ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤</li>
      </ul>
    </div>
  </div>

  <div class="test-section">
    <h2>üéØ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é</h2>
    <div class="info">
      <ol>
        <li><strong>–°–æ–∑–¥–∞–π—Ç–µ –≤–∏–¥–µ–æ-–æ–±–ª–∞—Å—Ç—å:</strong> –ü–ö–ú –Ω–∞ –ø–∞–Ω–æ—Ä–∞–º–µ ‚Üí "–°–æ–∑–¥–∞—Ç—å –≤–∏–¥–µ–æ-–æ–±–ª–∞—Å—Ç—å"</li>
        <li><strong>–ó–∞–≥—Ä—É–∑–∏—Ç–µ –≤–∏–¥–µ–æ:</strong> –ü–ö–ú –Ω–∞ –≤–∏–¥–µ–æ-–æ–±–ª–∞—Å—Ç–∏ ‚Üí "–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –≤–∏–¥–µ–æ" ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª</li>
        <li><strong>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã:</strong> –ü—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–ª—è—Ç—å—Å—è –∫–Ω–æ–ø–∫–∞ ‚ñ∂</li>
        <li><strong>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ:</strong> –ö–ª–∏–∫ –ø–æ ‚ñ∂ –¥–æ–ª–∂–µ–Ω –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤–∏–¥–µ–æ</li>
        <li><strong>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞—É–∑—É:</strong> –ü—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ –∏–≥—Ä–∞—é—â–µ–µ –≤–∏–¥–µ–æ –¥–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å—Å—è ‚è∏</li>
        <li><strong>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ localStorage:</strong> –í DevTools ‚Üí Application ‚Üí Storage —Ä–∞–∑–º–µ—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å ~0.7KB</li>
      </ol>
    </div>
  </div>

  <script>
    let testResults = [];

    function logResult(test, status, message, details = '') {
      const result = { test, status, message, details, timestamp: new Date() };
      testResults.push(result);
      updateDisplay();
      
      const icon = status === 'success' ? '‚úÖ' : status === 'error' ? '‚ùå' : status === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
      console.log(`${icon} ${test}: ${message}`, details ? details : '');
    }

    function updateDisplay() {
      const container = document.getElementById('testResults');
      container.innerHTML = testResults.map(result => {
        const statusClass = result.status;
        const icon = result.status === 'success' ? '‚úÖ' : 
                    result.status === 'error' ? '‚ùå' : 
                    result.status === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
        
        return `
          <div class="status ${statusClass}">
            <strong>${icon} ${result.test}</strong><br>
            ${result.message}
            ${result.details ? `<br><small>${result.details}</small>` : ''}
          </div>
        `;
      }).join('');
    }

    function testLocalStorage() {
      try {
        // –û—á–∏—â–∞–µ–º –¥–ª—è —á–∏—Å—Ç–æ–≥–æ —Ç–µ—Å—Ç–∞
        localStorage.removeItem('color_tour_hotspots');
        
        // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–∫–∞–∫ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏)
        const testHotspots = [
          {
            id: 'test_hotspot_1',
            sceneId: 'scene1',
            type: 'video-area',
            position: { x: 0, y: 0, z: -5 },
            width: 4,
            height: 3,
            // –ù–ï –≤–∫–ª—é—á–∞–µ–º videoUrl - –æ–Ω –Ω–µ –¥–æ–ª–∂–µ–Ω —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è
            title: '–¢–µ—Å—Ç–æ–≤–∞—è –≤–∏–¥–µ–æ-–æ–±–ª–∞—Å—Ç—å'
          }
        ];
        
        const dataToSave = JSON.stringify(testHotspots);
        localStorage.setItem('color_tour_hotspots', dataToSave);
        
        const sizeKB = (dataToSave.length / 1024).toFixed(2);
        
        if (sizeKB < 1) {
          logResult('localStorage —Ä–∞–∑–º–µ—Ä', 'success', 
            `–†–∞–∑–º–µ—Ä –æ–ø—Ç–∏–º–∞–ª–µ–Ω: ${sizeKB} KB`, 
            '–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –±–µ–∑ –±–æ–ª—å—à–∏—Ö –ø–æ–ª–µ–π');
        } else if (sizeKB < 10) {
          logResult('localStorage —Ä–∞–∑–º–µ—Ä', 'warning', 
            `–†–∞–∑–º–µ—Ä –ø—Ä–∏–µ–º–ª–µ–º—ã–π: ${sizeKB} KB`, 
            '–ú–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –Ω–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ');
        } else {
          logResult('localStorage —Ä–∞–∑–º–µ—Ä', 'error', 
            `–†–∞–∑–º–µ—Ä —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π: ${sizeKB} KB`, 
            '–í–æ–∑–º–æ–∂–Ω–æ, —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –±–æ–ª—å—à–∏–µ –ø–æ–ª—è —Ç–∏–ø–∞ videoUrl');
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ videoUrl –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
        const savedData = localStorage.getItem('color_tour_hotspots');
        if (savedData && !savedData.includes('videoUrl') && !savedData.includes('data:video')) {
          logResult('–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö', 'success', 
            'videoUrl –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ localStorage', 
            '–ë–æ–ª—å—à–∏–µ –¥–∞–Ω–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω—ã –∏–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
        } else {
          logResult('–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö', 'error', 
            'videoUrl –≤—Å–µ –µ—â–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è', 
            '–ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏–∫—É –∏—Å–∫–ª—é—á–µ–Ω–∏—è –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö');
        }
        
      } catch (error) {
        logResult('localStorage —Ç–µ—Å—Ç', 'error', 
          '–û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è localStorage', 
          error.message);
      }
    }

    function testVideoIntegration() {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–æ—Å—Ç—É–ø–Ω—ã
      fetch('./core/viewer_manager.js')
        .then(response => {
          if (response.ok) {
            logResult('–§–∞–π–ª—ã —Å–∏—Å—Ç–µ–º—ã', 'success', 
              'viewer_manager.js –¥–æ—Å—Ç—É–ø–µ–Ω', 
              '–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç');
          } else {
            throw new Error(`HTTP ${response.status}`);
          }
        })
        .catch(error => {
          logResult('–§–∞–π–ª—ã —Å–∏—Å—Ç–µ–º—ã', 'error', 
            'viewer_manager.js –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 
            error.message);
        });

      fetch('./core/hotspot_manager.js')
        .then(response => {
          if (response.ok) {
            logResult('–ú–µ–Ω–µ–¥–∂–µ—Ä —Ö–æ—Ç—Å–ø–æ—Ç–æ–≤', 'success', 
              'hotspot_manager.js –¥–æ—Å—Ç—É–ø–µ–Ω', 
              '–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ö–æ—Ç—Å–ø–æ—Ç–∞–º–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç');
          } else {
            throw new Error(`HTTP ${response.status}`);
          }
        })
        .catch(error => {
          logResult('–ú–µ–Ω–µ–¥–∂–µ—Ä —Ö–æ—Ç—Å–ø–æ—Ç–æ–≤', 'error', 
            'hotspot_manager.js –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 
            error.message);
        });
    }

    function testBrowserSupport() {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É A-Frame
      if (typeof window.AFRAME !== 'undefined') {
        logResult('A-Frame –ø–æ–¥–¥–µ—Ä–∂–∫–∞', 'success', 
          'A-Frame –∑–∞–≥—Ä—É–∂–µ–Ω', 
          `–í–µ—Ä—Å–∏—è: ${AFRAME.version}`);
      } else {
        logResult('A-Frame –ø–æ–¥–¥–µ—Ä–∂–∫–∞', 'warning', 
          'A-Frame –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ', 
          '–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã');
      }

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É –≤–∏–¥–µ–æ
      const video = document.createElement('video');
      if (video.canPlayType) {
        const mp4Support = video.canPlayType('video/mp4');
        const webmSupport = video.canPlayType('video/webm');
        
        if (mp4Support || webmSupport) {
          logResult('–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–∏–¥–µ–æ', 'success', 
            '–ë—Ä–∞—É–∑–µ—Ä –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ', 
            `MP4: ${mp4Support}, WebM: ${webmSupport}`);
        } else {
          logResult('–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–∏–¥–µ–æ', 'error', 
            '–ë—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ —Ñ–æ—Ä–º–∞—Ç—ã', 
            '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±—Ä–∞—É–∑–µ—Ä–∞');
        }
      }

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º localStorage
      if (typeof Storage !== "undefined") {
        logResult('localStorage –ø–æ–¥–¥–µ—Ä–∂–∫–∞', 'success', 
          'localStorage –¥–æ—Å—Ç—É–ø–µ–Ω', 
          '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç–∞–µ—Ç');
      } else {
        logResult('localStorage –ø–æ–¥–¥–µ—Ä–∂–∫–∞', 'error', 
          'localStorage –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 
          '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å');
      }
    }

    function clearStorage() {
      try {
        const keys = Object.keys(localStorage);
        const colorKeys = keys.filter(key => key.includes('color_tour'));
        
        colorKeys.forEach(key => localStorage.removeItem(key));
        
        logResult('–û—á–∏—Å—Ç–∫–∞ localStorage', 'success', 
          `–£–¥–∞–ª–µ–Ω–æ ${colorKeys.length} –∫–ª—é—á–µ–π`, 
          colorKeys.join(', '));
      } catch (error) {
        logResult('–û—á–∏—Å—Ç–∫–∞ localStorage', 'error', 
          '–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏', 
          error.message);
      }
    }

    function openMainApp() {
      window.open('./index.html', '_blank');
      logResult('–û—Ç–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è', 'info', 
        '–û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–æ –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ', 
        '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∏–¥–µ–æ –∫–æ–Ω—Ç—Ä–æ–ª—ã –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏');
    }

    function runAllTests() {
      testResults = [];
      updateDisplay();
      
      logResult('–ù–∞—á–∞–ª–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è', 'info', 
        '–ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–µ—Å—Ç–æ–≤', 
        new Date().toLocaleString());
      
      testBrowserSupport();
      testLocalStorage();
      testVideoIntegration();
      
      logResult('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ', 'success', 
        `–í—ã–ø–æ–ª–Ω–µ–Ω–æ ${testResults.length - 2} —Ç–µ—Å—Ç–æ–≤`, 
        '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—ã—à–µ');
    }

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    window.addEventListener('load', () => {
      setTimeout(runAllTests, 500);
    });
  </script>
</body>
</html>
