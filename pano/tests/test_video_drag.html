<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–¢–µ—Å—Ç –≤–∏–¥–µ–æ-–æ–±–ª–∞—Å—Ç–µ–π</title>
    <style>
      body {
        font-family: system-ui, sans-serif;
        background: #1a1a1a;
        color: white;
        padding: 20px;
      }
      .test-section {
        background: #333;
        padding: 20px;
        border-radius: 8px;
        margin: 20px 0;
      }
      .status {
        background: #222;
        padding: 10px;
        border-radius: 4px;
        margin: 10px 0;
        font-family: monospace;
      }
      .success {
        color: #4caf50;
      }
      .error {
        color: #f44336;
      }
      .warning {
        color: #ff9800;
      }
      .info {
        color: #2196f3;
      }
      button {
        padding: 10px 20px;
        background: #0066cc;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background: #0055aa;
      }
    </style>
  </head>
  <body>
    <h1>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤–∏–¥–µ–æ-–æ–±–ª–∞—Å—Ç–µ–π –∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è</h1>

    <div class="test-section">
      <h2>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
      <ol>
        <li>
          –û—Ç–∫—Ä–æ–π—Ç–µ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É:
          <a href="index.html" style="color: #4caf50">index.html</a>
        </li>
        <li>–°–æ–∑–¥–∞–π—Ç–µ –≤–∏–¥–µ–æ-–æ–±–ª–∞—Å—Ç—å —á–µ—Ä–µ–∑ –ø—Ä–∞–≤—ã–π –∫–ª–∏–∫ ‚Üí "üé¨ –í–∏–¥–µ–æ-–æ–±–ª–∞—Å—Ç—å"</li>
        <li>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç—å –≤–∏–¥–µ–æ-–æ–±–ª–∞—Å—Ç—å</li>
        <li>–í–µ—Ä–Ω–∏—Ç–µ—Å—å —Å—é–¥–∞ –∏ —Å–æ–æ–±—â–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç</li>
      </ol>
    </div>

    <div class="test-section">
      <h2>–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π</h2>
      <div id="diagnostic-results"></div>
      <button onclick="runDiagnostic()">üîç –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É</button>
    </div>

    <div class="test-section">
      <h2>–û–∂–∏–¥–∞–µ–º—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h2>
      <ul>
        <li class="success">
          ‚úÖ –ì–ª–æ–±–∞–ª—å–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å–æ–∫—Ä–∞—â–µ–Ω–∞ —Å 500ms –¥–æ 200ms
        </li>
        <li class="success">
          ‚úÖ –í–∏–¥–µ–æ-–æ–±–ª–∞—Å—Ç–∏ –∏—Å–∫–ª—é—á–µ–Ω—ã –∏–∑ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
        </li>
        <li class="success">
          ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ getHotspotData() –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–∏–ø–∞ –º–∞—Ä–∫–µ—Ä–∞
        </li>
        <li class="success">
          ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∑—É–º–∞ —Å –ø—Ä–æ—Ü–µ–Ω—Ç–∞–º–∏ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
        </li>
        <li class="success">‚úÖ –ó—É–º –∫–æ–ª–µ—Å–∏–∫–æ–º —Ä–∞–±–æ—Ç–∞–µ—Ç (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ –ª–æ–≥–∞–º–∏)</li>
        <li class="success">‚úÖ –ö–Ω–æ–ø–∫–∏ –∑—É–º–∞ —Ä–∞–±–æ—Ç–∞—é—Ç (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ –ª–æ–≥–∞–º–∏)</li>
      </ul>
    </div>

    <script>
      function runDiagnostic() {
        const results = document.getElementById("diagnostic-results");
        results.innerHTML = "";

        function addResult(message, type = "info") {
          const div = document.createElement("div");
          div.className = `status ${type}`;
          div.textContent = message;
          results.appendChild(div);
        }

        addResult("üîç –ù–∞—á–∏–Ω–∞–µ–º –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É...", "info");

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: –§–∞–π–ª—ã –º–æ–¥—É–ª–µ–π –¥–æ—Å—Ç—É–ø–Ω—ã
        Promise.all([
          fetch("./core/viewer_manager.js").then((r) => r.ok),
          fetch("./core/coordinate_manager.js").then((r) => r.ok),
          fetch("./main.js").then((r) => r.ok),
        ])
          .then((results) => {
            if (results.every((r) => r)) {
              addResult("‚úÖ –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–æ—Å—Ç—É–ø–Ω—ã", "success");
            } else {
              addResult("‚ùå –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ñ–∞–π–ª—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã", "error");
            }
          })
          .catch(() => {
            addResult("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤", "error");
          });

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: –ü—Ä–æ–≤–µ—Ä—è–µ–º localStorage
        try {
          const hotspots = JSON.parse(localStorage.getItem("hotspots") || "[]");
          addResult(
            `üìä –ù–∞–π–¥–µ–Ω–æ ${hotspots.length} —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –º–∞—Ä–∫–µ—Ä–æ–≤`,
            "info"
          );

          const videoAreas = hotspots.filter((h) => h.type === "video-area");
          if (videoAreas.length > 0) {
            addResult(
              `üé¨ –ù–∞–π–¥–µ–Ω–æ ${videoAreas.length} –≤–∏–¥–µ–æ-–æ–±–ª–∞—Å—Ç–µ–π`,
              "success"
            );
          } else {
            addResult(
              "‚ö†Ô∏è –í–∏–¥–µ–æ-–æ–±–ª–∞—Å—Ç–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã - —Å–æ–∑–¥–∞–π—Ç–µ –∏—Ö –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è",
              "warning"
            );
          }
        } catch (e) {
          addResult("‚ùå –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è localStorage: " + e.message, "error");
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: –ì–ª–æ–±–∞–ª—å–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
        addResult(
          "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—É—é –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è...",
          "info"
        );
        window._dragSystemBlocked = true;
        setTimeout(() => {
          if (window._dragSystemBlocked) {
            addResult(
              "‚ö†Ô∏è –ì–ª–æ–±–∞–ª—å–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞ - –Ω–æ—Ä–º–∞–ª—å–Ω–æ –ø–æ—Å–ª–µ –ø—Ä–∞–≤–æ–≥–æ –∫–ª–∏–∫–∞",
              "warning"
            );
          } else {
            addResult(
              "‚úÖ –ì–ª–æ–±–∞–ª—å–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å–Ω—è—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏",
              "success"
            );
          }
          window._dragSystemBlocked = false;
        }, 300);

        addResult("üéâ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞", "success");
      }

      // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
      setTimeout(runDiagnostic, 1000);
    </script>
  </body>
</html>
