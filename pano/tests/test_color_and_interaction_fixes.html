<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π —Ü–≤–µ—Ç–æ–≤ –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <style>
      body {
        margin: 0;
        padding: 20px;
        font-family: Arial, sans-serif;
        background: #1a1a1a;
        color: white;
      }

      .test-container {
        display: flex;
        height: calc(100vh - 40px);
        gap: 20px;
      }

      .viewer-section {
        flex: 2;
        border: 2px solid #4caf50;
        border-radius: 8px;
        overflow: hidden;
      }

      .controls-section {
        flex: 1;
        background: #2a2a2a;
        border-radius: 8px;
        padding: 20px;
        overflow-y: auto;
      }

      .test-group {
        margin-bottom: 30px;
        padding: 15px;
        border: 1px solid #666;
        border-radius: 5px;
      }

      .test-group h3 {
        color: #4caf50;
        margin-top: 0;
      }

      .test-button {
        background: #646cff;
        color: white;
        border: none;
        padding: 8px 16px;
        margin: 5px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
      }

      .test-button:hover {
        background: #5a67ea;
      }

      .test-button.danger {
        background: #ff4444;
      }

      .test-button.danger:hover {
        background: #ff3333;
      }

      .status-display {
        background: #1a1a1a;
        border: 1px solid #333;
        border-radius: 4px;
        padding: 10px;
        font-family: monospace;
        font-size: 11px;
        max-height: 200px;
        overflow-y: auto;
        margin-top: 10px;
      }

      .fix-status {
        padding: 5px;
        margin: 5px 0;
        border-radius: 3px;
      }

      .fix-status.fixed {
        background: #1b4332;
        border-left: 3px solid #4caf50;
      }

      .fix-status.issue {
        background: #4a1a1a;
        border-left: 3px solid #ff4444;
      }

      .fix-status.testing {
        background: #1a3a4a;
        border-left: 3px solid #2196f3;
      }
    </style>
  </head>
  <body>
    <h1>üîß –¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π —Ü–≤–µ—Ç–æ–≤ –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π</h1>

    <div class="test-container">
      <div class="viewer-section">
        <div id="viewerContainer" style="width: 100%; height: 100%"></div>
      </div>

      <div class="controls-section">
        <div class="test-group">
          <h3>üìä –°—Ç–∞—Ç—É—Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π</h3>
          <div id="fixStatus">
            <div class="fix-status fixed">
              ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –º—ã—à–∏ (NaN)
            </div>
            <div class="fix-status fixed">
              ‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–≤–µ—Ç–æ–≤ —Ö–æ—Ç—Å–ø–æ—Ç–æ–≤
            </div>
            <div class="fix-status fixed">‚úÖ –£–ª—É—á—à–µ–Ω–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ü–µ–Ω</div>
            <div class="fix-status fixed">
              ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª –≤–∏–¥–µ–æ-–æ–±–ª–∞—Å—Ç–µ–π
            </div>
            <div class="fix-status fixed">
              ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –ø–æ –≤–∏–¥–µ–æ-–æ–±–ª–∞—Å—Ç—è–º
            </div>
            <div class="fix-status testing">
              üîÑ –ì–ª–æ–±–∞–ª—å–Ω–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –º—ã—à–∏
            </div>
          </div>
        </div>

        <div class="test-group">
          <h3>üé® –¢–µ—Å—Ç —Ü–≤–µ—Ç–æ–≤ —Ö–æ—Ç—Å–ø–æ—Ç–æ–≤</h3>
          <button class="test-button" onclick="testHotspotColors()">
            –°–æ–∑–¥–∞—Ç—å —Ö–æ—Ç—Å–ø–æ—Ç (–∫—Ä–∞—Å–Ω—ã–π)
          </button>
          <button class="test-button" onclick="testInfopointColors()">
            –°–æ–∑–¥–∞—Ç—å –∏–Ω—Ñ–æ—Ç–æ—á–∫—É (—Å–∏–Ω–∏–π)
          </button>
          <button class="test-button" onclick="testColorPreservation()">
            –¢–µ—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ü–≤–µ—Ç–æ–≤
          </button>
          <div class="status-display" id="colorTestStatus">
            –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ü–≤–µ—Ç–æ–≤ –º–∞—Ä–∫–µ—Ä–æ–≤...
          </div>
        </div>

        <div class="test-group">
          <h3>üé¨ –¢–µ—Å—Ç –≤–∏–¥–µ–æ-–æ–±–ª–∞—Å—Ç–µ–π</h3>
          <button class="test-button" onclick="createVideoArea()">
            –°–æ–∑–¥–∞—Ç—å –≤–∏–¥–µ–æ-–æ–±–ª–∞—Å—Ç—å
          </button>
          <button class="test-button" onclick="testVideoInteraction()">
            –¢–µ—Å—Ç –∫–ª–∏–∫–∞ –ø–æ –≤–∏–¥–µ–æ
          </button>
          <button class="test-button" onclick="testVideoMaterial()">
            –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª
          </button>
          <div class="status-display" id="videoTestStatus">
            –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–∏–¥–µ–æ-–æ–±–ª–∞—Å—Ç–µ–π...
          </div>
        </div>

        <div class="test-group">
          <h3>üñ±Ô∏è –¢–µ—Å—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π</h3>
          <button class="test-button" onclick="testMouseTracking()">
            –¢–µ—Å—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –º—ã—à–∏
          </button>
          <button class="test-button" onclick="testDragging()">
            –¢–µ—Å—Ç –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
          </button>
          <button class="test-button" onclick="testRightClick()">
            –¢–µ—Å—Ç –ø—Ä–∞–≤–æ–≥–æ –∫–ª–∏–∫–∞
          </button>
          <div class="status-display" id="interactionTestStatus">
            –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –º–∞—Ä–∫–µ—Ä–∞–º–∏...
          </div>
        </div>

        <div class="test-group">
          <h3>üîÑ –¢–µ—Å—Ç –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –º–µ–∂–¥—É —Å—Ü–µ–Ω–∞–º–∏</h3>
          <button class="test-button" onclick="testSceneTransition()">
            –ü–µ—Ä–µ—Ö–æ–¥ –º–µ–∂–¥—É —Å—Ü–µ–Ω–∞–º–∏
          </button>
          <button class="test-button" onclick="checkColorAfterTransition()">
            –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–≤–µ—Ç–æ–≤ –ø–æ—Å–ª–µ –ø–µ—Ä–µ—Ö–æ–¥–∞
          </button>
          <button class="test-button danger" onclick="testSceneDeletion()">
            –¢–µ—Å—Ç —É–¥–∞–ª–µ–Ω–∏—è —Å—Ü–µ–Ω—ã
          </button>
          <div class="status-display" id="sceneTestStatus">
            –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è...
          </div>
        </div>

        <div class="test-group">
          <h3>üêõ –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
          <button class="test-button" onclick="debugMarkers()">
            –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –º–∞—Ä–∫–µ—Ä–æ–≤
          </button>
          <button class="test-button" onclick="debugMousePosition()">
            –ü–æ–∑–∏—Ü–∏—è –º—ã—à–∏
          </button>
          <button class="test-button" onclick="clearConsole()">
            –û—á–∏—Å—Ç–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å
          </button>
          <div class="status-display" id="debugStatus">
            –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω–∞ –∑–¥–µ—Å—å...
          </div>
        </div>
      </div>
    </div>

    <!-- –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏ -->
    <script type="module" src="core/coordinate_manager.js"></script>
    <script type="module" src="core/hotspot_manager.js"></script>
    <script type="module" src="core/scene_manager.js"></script>
    <script type="module" src="core/viewer_manager.js"></script>
    <script type="module" src="core/project_manager.js"></script>
    <script type="module" src="core/export_manager.js"></script>
    <script type="module" src="ui/hotspot-editor.js"></script>

    <script type="module">
      import ViewerManager from "./core/viewer_manager.js";
      import HotspotManager from "./core/hotspot_manager.js";
      import SceneManager from "./core/scene_manager.js";

      // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
      let viewerManager, hotspotManager, sceneManager;
      let testMarkerCount = 0;

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
      async function initializeTest() {
        try {
          console.log("üîß –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥—ã...");

          // –°–æ–∑–¥–∞–µ–º –º–µ–Ω–µ–¥–∂–µ—Ä—ã
          hotspotManager = new HotspotManager();
          viewerManager = new ViewerManager("viewerContainer", hotspotManager);
          sceneManager = new SceneManager(viewerManager, hotspotManager);

          // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏
          window.viewerManager = viewerManager;
          window.hotspotManager = hotspotManager;
          window.sceneManager = sceneManager;

          // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—É—é —Å—Ü–µ–Ω—É
          const scene1Data = {
            name: "–¢–µ—Å—Ç–æ–≤–∞—è —Å—Ü–µ–Ω–∞ 1",
            imageSrc:
              "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAyNCIgaGVpZ2h0PSI1MTIiIHZpZXdCb3g9IjAgMCAxMDI0IDUxMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjEwMjQiIGhlaWdodD0iNTEyIiBmaWxsPSIjMWExYTFhIi8+Cjx0ZXh0IHg9IjUxMiIgeT0iMjU2IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSJ3aGl0ZSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjQ4Ij7QotC10YHRgtC+0LLQsNGPINGB0YbQtdC90LA8L3RleHQ+Cjwvc3ZnPgo=",
          };

          await sceneManager.addScene(scene1Data);

          const scene2Data = {
            name: "–¢–µ—Å—Ç–æ–≤–∞—è —Å—Ü–µ–Ω–∞ 2",
            imageSrc:
              "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAyNCIgaGVpZ2h0PSI1MTIiIHZpZXdCb3g9IjAgMCAxMDI0IDUxMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjEwMjQiIGhlaWdodD0iNTEyIiBmaWxsPSIjMmEyYTJhIi8+Cjx0ZXh0IHg9IjUxMiIgeT0iMjU2IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSJ3aGl0ZSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjQ4Ij7QotC10YHRgtC+0LLQsNGPINGB0YbQtdC90LAgMjwvdGV4dD4KPC9zdmc+Cg==",
          };

          await sceneManager.addScene(scene2Data);

          updateStatus("debugStatus", "‚úÖ –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ä–µ–¥–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞");
          console.log("‚úÖ –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ä–µ–¥–∞ –≥–æ—Ç–æ–≤–∞");
        } catch (error) {
          console.error("‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:", error);
          updateStatus(
            "debugStatus",
            "‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: " + error.message
          );
        }
      }

      // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
      function updateStatus(elementId, message) {
        const element = document.getElementById(elementId);
        if (element) {
          element.innerHTML =
            `${new Date().toLocaleTimeString()}: ${message}<br>` +
            element.innerHTML;
        }
      }

      function getRandomPosition() {
        const radius = 8;
        const phi = Math.random() * Math.PI * 2;
        const theta = Math.PI / 2 + ((Math.random() - 0.5) * Math.PI) / 3;

        return {
          x: radius * Math.sin(theta) * Math.cos(phi),
          y: radius * Math.cos(theta) + Math.random() * 2 - 1,
          z: radius * Math.sin(theta) * Math.sin(phi),
        };
      }

      // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ–±–ª–∞—Å—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ HTML
      window.testHotspotColors = function () {
        testMarkerCount++;
        const position = getRandomPosition();

        const hotspotData = {
          title: `–¢–µ—Å—Ç —Ö–æ—Ç—Å–ø–æ—Ç ${testMarkerCount}`,
          description: "–¢–µ—Å—Ç–æ–≤—ã–π —Ö–æ—Ç—Å–ø–æ—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ü–≤–µ—Ç–æ–≤",
          type: "hotspot",
          position: `${position.x} ${position.y} ${position.z}`,
          color: "#ff0000", // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∫—Ä–∞—Å–Ω—ã–π —Ü–≤–µ—Ç
          icon: "arrow",
          size: "0.4",
        };

        if (hotspotManager) {
          const currentScene = sceneManager.getCurrentScene();
          if (currentScene) {
            hotspotData.sceneId = currentScene.id;
            const hotspot = hotspotManager.addHotspot(hotspotData);
            viewerManager.createVisualMarker(hotspot);

            updateStatus(
              "colorTestStatus",
              `‚úÖ –°–æ–∑–¥–∞–Ω —Ö–æ—Ç—Å–ø–æ—Ç —Å —Ü–≤–µ—Ç–æ–º: ${hotspotData.color}`
            );
          } else {
            updateStatus("colorTestStatus", "‚ùå –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π —Å—Ü–µ–Ω—ã");
          }
        }
      };

      window.testInfopointColors = function () {
        testMarkerCount++;
        const position = getRandomPosition();

        const hotspotData = {
          title: `–¢–µ—Å—Ç –∏–Ω—Ñ–æ—Ç–æ—á–∫–∞ ${testMarkerCount}`,
          description: "–¢–µ—Å—Ç–æ–≤–∞—è –∏–Ω—Ñ–æ—Ç–æ—á–∫–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ü–≤–µ—Ç–æ–≤",
          type: "info-point",
          position: `${position.x} ${position.y} ${position.z}`,
          color: "#0066cc", // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å–∏–Ω–∏–π —Ü–≤–µ—Ç
          icon: "sphere",
          size: "0.3",
        };

        if (hotspotManager) {
          const currentScene = sceneManager.getCurrentScene();
          if (currentScene) {
            hotspotData.sceneId = currentScene.id;
            const hotspot = hotspotManager.addHotspot(hotspotData);
            viewerManager.createVisualMarker(hotspot);

            updateStatus(
              "colorTestStatus",
              `‚úÖ –°–æ–∑–¥–∞–Ω–∞ –∏–Ω—Ñ–æ—Ç–æ—á–∫–∞ —Å —Ü–≤–µ—Ç–æ–º: ${hotspotData.color}`
            );
          } else {
            updateStatus("colorTestStatus", "‚ùå –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π —Å—Ü–µ–Ω—ã");
          }
        }
      };

      window.testColorPreservation = function () {
        updateStatus(
          "colorTestStatus",
          "üîÑ –¢–µ—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ü–≤–µ—Ç–æ–≤ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–∞—Ö..."
        );

        // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –º–µ–∂–¥—É —Å—Ü–µ–Ω–∞–º–∏ —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ü–≤–µ—Ç–æ–≤
        const scenes = sceneManager.getAllScenes();
        if (scenes.length >= 2) {
          const currentScene = sceneManager.getCurrentScene();
          const nextScene = scenes.find((s) => s.id !== currentScene.id);

          sceneManager.switchToScene(nextScene.id);

          setTimeout(() => {
            sceneManager.switchToScene(currentScene.id);

            setTimeout(() => {
              updateStatus(
                "colorTestStatus",
                "‚úÖ –ü–µ—Ä–µ—Ö–æ–¥—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ü–≤–µ—Ç–∞ –º–∞—Ä–∫–µ—Ä–æ–≤"
              );
            }, 1000);
          }, 1000);
        } else {
          updateStatus("colorTestStatus", "‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ü–µ–Ω –¥–ª—è —Ç–µ—Å—Ç–∞");
        }
      };

      window.createVideoArea = function () {
        testMarkerCount++;
        const position = getRandomPosition();

        const hotspotData = {
          title: `–í–∏–¥–µ–æ-–æ–±–ª–∞—Å—Ç—å ${testMarkerCount}`,
          description: "–¢–µ—Å—Ç–æ–≤–∞—è –≤–∏–¥–µ–æ-–æ–±–ª–∞—Å—Ç—å",
          type: "video-area",
          position: `${position.x} ${position.y} ${position.z}`,
          videoWidth: 3,
          videoHeight: 2,
          // –ë–µ–∑ videoUrl —á—Ç–æ–±—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥–ª—É—à–∫—É
        };

        if (hotspotManager) {
          const currentScene = sceneManager.getCurrentScene();
          if (currentScene) {
            hotspotData.sceneId = currentScene.id;
            const hotspot = hotspotManager.addHotspot(hotspotData);
            viewerManager.createVisualMarker(hotspot);

            updateStatus(
              "videoTestStatus",
              `‚úÖ –°–æ–∑–¥–∞–Ω–∞ –≤–∏–¥–µ–æ-–æ–±–ª–∞—Å—Ç—å –±–µ–∑ –≤–∏–¥–µ–æ (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–µ—Ä–æ–π)`
            );
          } else {
            updateStatus("videoTestStatus", "‚ùå –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π —Å—Ü–µ–Ω—ã");
          }
        }
      };

      window.testVideoInteraction = function () {
        const videoAreas = document.querySelectorAll(
          '[data-video-plane="true"]'
        );
        updateStatus(
          "videoTestStatus",
          `üîç –ù–∞–π–¥–µ–Ω–æ –≤–∏–¥–µ–æ-–æ–±–ª–∞—Å—Ç–µ–π: ${videoAreas.length}`
        );

        if (videoAreas.length > 0) {
          updateStatus(
            "videoTestStatus",
            "üëÜ –ö–ª–∏–∫–Ω–∏—Ç–µ –ø–æ –≤–∏–¥–µ–æ-–æ–±–ª–∞—Å—Ç–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"
          );
        } else {
          updateStatus("videoTestStatus", "‚ö†Ô∏è –°–æ–∑–¥–∞–π—Ç–µ —Å–Ω–∞—á–∞–ª–∞ –≤–∏–¥–µ–æ-–æ–±–ª–∞—Å—Ç—å");
        }
      };

      window.testVideoMaterial = function () {
        const videoAreas = document.querySelectorAll(
          '[data-video-plane="true"]'
        );
        videoAreas.forEach((plane, index) => {
          const material = plane.getAttribute("material");
          updateStatus(
            "videoTestStatus",
            `üìù –í–∏–¥–µ–æ-–æ–±–ª–∞—Å—Ç—å ${index + 1}: ${JSON.stringify(material)}`
          );
        });
      };

      window.testMouseTracking = function () {
        const mousePos = window._lastMousePosition;
        updateStatus(
          "interactionTestStatus",
          `üñ±Ô∏è –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è –º—ã—à–∏: ${JSON.stringify(mousePos)}`
        );

        // –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏
        if (viewerManager && viewerManager.aframeScene) {
          updateStatus(
            "interactionTestStatus",
            "‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –º—ã—à–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç"
          );
        } else {
          updateStatus("interactionTestStatus", "‚ùå ViewerManager –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω");
        }
      };

      window.testDragging = function () {
        const markers = document.querySelectorAll("[data-hotspot-id]");
        updateStatus(
          "interactionTestStatus",
          `üîç –ù–∞–π–¥–µ–Ω–æ –º–∞—Ä–∫–µ—Ä–æ–≤ –¥–ª—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è: ${markers.length}`
        );
        updateStatus(
          "interactionTestStatus",
          "üëÜ –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç—å –ª—é–±–æ–π –º–∞—Ä–∫–µ—Ä"
        );
      };

      window.testRightClick = function () {
        updateStatus(
          "interactionTestStatus",
          "üñ±Ô∏è –ö–ª–∏–∫–Ω–∏—Ç–µ –ø—Ä–∞–≤–æ–π –∫–Ω–æ–ø–∫–æ–π –º—ã—à–∏ –ø–æ –ø—É—Å—Ç–æ–º—É –º–µ—Å—Ç—É –∏–ª–∏ –º–∞—Ä–∫–µ—Ä—É"
        );
      };

      window.testSceneTransition = function () {
        const scenes = sceneManager.getAllScenes();
        if (scenes.length >= 2) {
          const currentScene = sceneManager.getCurrentScene();
          const nextScene = scenes.find((s) => s.id !== currentScene.id);

          updateStatus(
            "sceneTestStatus",
            `üîÑ –ü–µ—Ä–µ—Ö–æ–¥: ${currentScene.name} ‚Üí ${nextScene.name}`
          );
          sceneManager.switchToScene(nextScene.id);
        } else {
          updateStatus("sceneTestStatus", "‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ü–µ–Ω");
        }
      };

      window.checkColorAfterTransition = function () {
        const markers = document.querySelectorAll("[data-hotspot-id]");
        markers.forEach((marker, index) => {
          const shape = marker.querySelector(".interactive");
          const color = shape ? shape.getAttribute("color") : "–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";
          updateStatus(
            "sceneTestStatus",
            `üé® –ú–∞—Ä–∫–µ—Ä ${index + 1}: —Ü–≤–µ—Ç ${color}`
          );
        });
      };

      window.testSceneDeletion = function () {
        const scenes = sceneManager.getAllScenes();
        if (scenes.length > 1) {
          const sceneToDelete = scenes[scenes.length - 1];
          updateStatus(
            "sceneTestStatus",
            `üóëÔ∏è –ü–æ–ø—ã—Ç–∫–∞ —É–¥–∞–ª–∏—Ç—å —Å—Ü–µ–Ω—É: ${sceneToDelete.name}`
          );

          sceneManager.removeScene(sceneToDelete.id).then((success) => {
            if (success) {
              updateStatus("sceneTestStatus", "‚úÖ –°—Ü–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞");
            } else {
              updateStatus("sceneTestStatus", "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Å—Ü–µ–Ω—É");
            }
          });
        } else {
          updateStatus("sceneTestStatus", "‚ö†Ô∏è –ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é —Å—Ü–µ–Ω—É");
        }
      };

      window.debugMarkers = function () {
        const markers = document.querySelectorAll("[data-hotspot-id]");
        updateStatus(
          "debugStatus",
          `üîç –ù–∞–π–¥–µ–Ω–æ –º–∞—Ä–∫–µ—Ä–æ–≤ –≤ DOM: ${markers.length}`
        );

        markers.forEach((marker, index) => {
          const hotspotId = marker.getAttribute("data-hotspot-id");
          const position = marker.getAttribute("position");
          const visible = marker.getAttribute("visible");
          updateStatus(
            "debugStatus",
            `üìç –ú–∞—Ä–∫–µ—Ä ${index + 1}: ID=${hotspotId}, pos=${position}, visible=${visible}`
          );
        });

        const hotspots = hotspotManager ? hotspotManager.getAllHotspots() : [];
        updateStatus(
          "debugStatus",
          `üíæ –•–æ—Ç—Å–ø–æ—Ç–æ–≤ –≤ –º–µ–Ω–µ–¥–∂–µ—Ä–µ: ${hotspots.length}`
        );
      };

      window.debugMousePosition = function () {
        const pos = window._lastMousePosition;
        updateStatus(
          "debugStatus",
          `üñ±Ô∏è –ü–æ—Å–ª–µ–¥–Ω—è—è –ø–æ–∑–∏—Ü–∏—è –º—ã—à–∏: ${JSON.stringify(pos)}`
        );
      };

      window.clearConsole = function () {
        console.clear();
        updateStatus("debugStatus", "üßπ –ö–æ–Ω—Å–æ–ª—å –æ—á–∏—â–µ–Ω–∞");
      };

      // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
      initializeTest();
    </script>
  </body>
</html>
